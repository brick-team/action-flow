<?xml version="1.0" encoding="UTF-8"?>

<ae xmlns="http://github.hufer/">
    <params>
        <param group="a">
            <key>username</key>
            <value>zhangsan</value>
        </param>

        <param group="a">
            <key>password</key>
            <value>lisi</value>
        </param>
    </params>
    <actions>
        <action id="login" class="com.github.brick.action.flow.LoginAction" method="login">
            <param index="0" arg_name="username" param_group="a" ex="username"
                   type="java.lang.String"/>
            <param index="1" arg_name="password" param_group="a" ex="password"
                   type="java.lang.String"></param>
        </action>
        <action id="sendPoint" class="com.github.brick.action.flow.SendPointAction"
                method="sendPoint" async="true">
            <param index="0" arg_name="uid" param_group="a" ex="username" type="java.lang.String">
            </param>
            <param index="1" arg_name="point" value="10" type="java.lang.Integer">
                <format id="f1" class="com.github.brick.action.flow.method.format.num.StringToIntegerFormat"></format>
            </param>
        </action>
    </actions>

    <watchers>
        <watcher id="w1" exid="e3" condition="> 10">
            <then actionId="sendPoint"/>
            <then actionId="sendPoint"/>
            <catch actionId="sendPoint"/>
        </watcher>
    </watchers>

    <result>
        <key name="r1" exid="e1"/>
        <key name="r2" exid="e2"/>
    </result>

    <extracts>
        <extract id="e1" fromAction="login" el="$.username"/>
        <extract id="e2" fromAction="login" el="$.login_time"/>
        <extract id="e3" fromAction="login" el="$.age"/>
    </extracts>

    <flows>

        <flow id="1">
            <work id="work1" type="action" ref_id="login">
                <catch>
                    <work id="work2" type="watcher" ref_id="w1">
                    </work>
                </catch>
                <then>
                    <work id="work2" type="watcher" ref_id="w1">
                        <then>
                            <work id="work3" type="watcher" ref_id="w1">
                                <then>
                                    <work id="work3" type="watcher" ref_id="w1">
                                        <then>
                                            <work id="work3" type="watcher" ref_id="w1">

                                            </work>
                                        </then>
                                    </work>
                                </then>
                            </work>
                        </then>
                    </work>
                </then>
            </work>
        </flow>


        <flow id="2">
            <work id="work1" type="action" ref_id="login">
                <catch>
                    <work id="work2" type="watcher" ref_id="w1">
                    </work>
                </catch>
                <then>
                    <work id="work2" type="watcher" ref_id="w1">
                        <then>
                            <work id="work3" type="watcher" ref_id="w1"/>
                        </then>
                    </work>
                    <work id="work2" type="watcher" ref_id="w1">
                        <then>
                            <work id="work3" type="watcher" ref_id="w1"/>
                        </then>
                        <catch>
                            <work id="work3" type="watcher" ref_id="w1"/>
                        </catch>

                    </work>
                </then>

            </work>


            <work id="22" type="action" ref_id="login">
                <then>
                    <work id="work2" type="watcher" ref_id="w1">
                        <then>
                            <work id="work3" type="watcher" ref_id="w1"/>
                        </then>
                    </work>

                    <work id="work2" type="watcher" ref_id="w1">
                        <then>
                            <work id="work3" type="watcher" ref_id="w1"/>
                        </then>
                    </work>
                </then>
            </work>


        </flow>
    </flows>

</ae>